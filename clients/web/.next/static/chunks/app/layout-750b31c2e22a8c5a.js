(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{47717:function(e,o,t){Promise.resolve().then(t.t.bind(t,31796,23)),Promise.resolve().then(t.bind(t,19894)),Promise.resolve().then(t.t.bind(t,72354,23))},19894:function(e,o,t){"use strict";t.r(o),t.d(o,{AuthProvider:function(){return d},useAuth:function(){return m}});var r=t(89075),n=t(50511),l=t(52453);let i=null,s=async(e,o,t)=>await t(),a={SESSION_BRIDGE:"leetloop_session_bridge"},c={AUTH_CHANGE:"leetloop:auth-change",SIGNED_OUT:"leetloop:signed-out",GUEST_ID:"leetloop:guest-id"};function u(e){if(console.log("[LeetLoop Web] storeSessionBridge called, hasSession:",!!e),(null==e?void 0:e.access_token)&&(null==e?void 0:e.refresh_token)){let o={access_token:e.access_token,refresh_token:e.refresh_token};localStorage.setItem(a.SESSION_BRIDGE,JSON.stringify(o)),console.log("[LeetLoop Web] Session bridge stored in localStorage"),window.dispatchEvent(new CustomEvent(c.AUTH_CHANGE,{detail:o})),console.log("[LeetLoop Web] Dispatched auth-change event")}else localStorage.removeItem(a.SESSION_BRIDGE)}function g(){localStorage.removeItem(a.SESSION_BRIDGE),window.dispatchEvent(new CustomEvent(c.SIGNED_OUT))}let p=(0,n.createContext)(void 0);function d(e){let{children:o}=e,[t,a]=(0,n.useState)(null),[d,m]=(0,n.useState)(null),[I,h]=(0,n.useState)(!0),f=(0,n.useMemo)(()=>i||(i=(0,l.createBrowserClient)("https://ewezpbczwioxyflyffyy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3ZXpwYmN6d2lveHlmbHlmZnl5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzMDI3MzAsImV4cCI6MjA4NDg3ODczMH0.XxVIJRRYNR_IdMhVN0gGMVYghb19Uyly4rbwxJJKDVg",{auth:{flowType:"pkce",detectSessionInUrl:!0,persistSession:!0,debug:!1,lock:s}})),[]),S=(null==t?void 0:t.id)||_();(0,n.useEffect)(()=>{let e=!0,o=null;(async()=>{try{let{data:{session:t}}=await f.auth.getSession();if(e){var o;m(t),a(null!==(o=null==t?void 0:t.user)&&void 0!==o?o:null),h(!1),u(t)}}catch(o){o instanceof Error&&"AbortError"===o.name?console.log("[LeetLoop] Ignoring AbortError in dev mode"):console.error("[LeetLoop] Error getting session:",o),e&&h(!1)}})();let t=_();t&&window.dispatchEvent(new CustomEvent(c.GUEST_ID,{detail:t}));try{let{data:t}=f.auth.onAuthStateChange(async(o,t)=>{if(e){var r;m(t),a(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),h(!1),u(t),"SIGNED_IN"===o&&(null==t?void 0:t.user)&&await L(f,t.user.id),"SIGNED_OUT"===o&&g()}});o=t.subscription}catch(e){console.error("[LeetLoop] Error setting up auth listener:",e)}return()=>{e=!1,null==o||o.unsubscribe()}},[f]);let E=async(e,o)=>{let{error:t}=await f.auth.signInWithPassword({email:e,password:o});if(t)throw t},w=async(e,o)=>{let{error:t}=await f.auth.signUp({email:e,password:o});if(t)throw t},v=async()=>{let{error:e}=await f.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(e)throw e},b=async()=>{let{error:e}=await f.auth.signOut();if(e)throw e;g()};return(0,r.jsx)(p.Provider,{value:{user:t,session:d,userId:S,loading:I,signIn:E,signUp:w,signInWithGoogle:v,signOut:b},children:o})}function m(){let e=(0,n.useContext)(p);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function _(){let e=localStorage.getItem("leetloop_user_id");return e||(e=crypto.randomUUID(),localStorage.setItem("leetloop_user_id",e)),e}async function L(e,o){if("true"===localStorage.getItem("leetloop_migration_complete")){console.log("[LeetLoop] Migration already marked complete, skipping"),console.log('[LeetLoop] To retry migration, run: localStorage.removeItem("leetloop_migration_complete")');return}let t=localStorage.getItem("leetloop_user_id");if(!t){console.log("[LeetLoop] No guest user ID found, nothing to migrate"),localStorage.setItem("leetloop_migration_complete","true");return}if(t===o){console.log("[LeetLoop] Guest ID matches auth ID, no migration needed"),localStorage.setItem("leetloop_migration_complete","true");return}console.log("[LeetLoop] Starting migration..."),console.log("[LeetLoop] Guest UUID:",t),console.log("[LeetLoop] Auth User ID:",o);try{let{data:r,error:n}=await e.rpc("migrate_guest_to_auth",{p_guest_id:t,p_auth_id:o});if(n){console.error("[LeetLoop] Migration RPC error:",n),console.error("[LeetLoop] Error code:",n.code),console.error("[LeetLoop] Error message:",n.message),console.error("[LeetLoop] Error details:",n.details),console.error("[LeetLoop] Migration NOT marked complete due to error"),console.error("[LeetLoop] You can manually migrate by running SQL in Supabase:"),console.error("UPDATE submissions SET user_id = '".concat(o,"' WHERE user_id = '").concat(t,"';")),console.error("UPDATE skill_scores SET user_id = '".concat(o,"' WHERE user_id = '").concat(t,"';")),console.error("UPDATE review_queue SET user_id = '".concat(o,"' WHERE user_id = '").concat(t,"';"));return}if(!r||"object"!=typeof r){console.error("[LeetLoop] Migration returned unexpected data:",r),console.error("[LeetLoop] Migration NOT marked complete due to unexpected response");return}if(!0!==r.success){console.error("[LeetLoop] Migration returned success=false:",r),console.error("[LeetLoop] Migration NOT marked complete");return}console.log("[LeetLoop] Migration successful!"),console.log("[LeetLoop] Migrated counts:",r.migrated),localStorage.setItem("leetloop_migration_complete","true"),localStorage.setItem("leetloop_user_id",o),console.log("[LeetLoop] Updated local user ID to auth ID")}catch(e){console.error("[LeetLoop] Migration exception:",e),console.error("[LeetLoop] Migration NOT marked complete due to exception"),console.error("[LeetLoop] Guest UUID for manual migration:",t),console.error("[LeetLoop] Auth User ID for manual migration:",o)}}window.resetLeetLoopMigration=()=>{localStorage.removeItem("leetloop_migration_complete"),console.log("[LeetLoop] Migration flag cleared. Sign out and back in to retry migration.")},window.getLeetLoopMigrationInfo=()=>{console.log("[LeetLoop] Migration complete:",localStorage.getItem("leetloop_migration_complete")),console.log("[LeetLoop] Guest user ID:",localStorage.getItem("leetloop_user_id"))}},31796:function(){},72354:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[453,852,999,744],function(){return e(e.s=47717)}),_N_E=e.O()}]);