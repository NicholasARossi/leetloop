(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{70332:function(e,t,o){Promise.resolve().then(o.bind(o,72457))},72457:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return i}});var r=o(89075),s=o(50511),l=o(65095),a=o(980),n=o(19894);function i(){let e=(0,l.useRouter)(),{signIn:t,signUp:o,signInWithGoogle:i}=(0,n.useAuth)(),[c,u]=(0,s.useState)(!1),[d,m]=(0,s.useState)(""),[p,g]=(0,s.useState)(""),[h,f]=(0,s.useState)(""),[x,L]=(0,s.useState)(!1),[b,S]=(0,s.useState)(!1);async function _(r){r.preventDefault(),f(""),L(!0);try{c?(await o(d,p),f("Check your email to confirm your account.")):(await t(d,p),e.push("/today"))}catch(e){f(e.message||"An error occurred")}finally{L(!1)}}async function I(){f(""),S(!0);try{await i()}catch(e){f(e.message||"An error occurred"),S(!1)}}return(0,r.jsx)("main",{className:"min-h-screen flex items-center justify-center p-8",children:(0,r.jsxs)("div",{className:"card max-w-md w-full p-8",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)(a.default,{href:"/",className:"text-2xl font-bold text-brand-600",children:"LeetLoop"}),(0,r.jsx)("p",{className:"text-slate-500 mt-2",children:c?"Create an account":"Sign in to your account"})]}),(0,r.jsxs)("button",{onClick:I,disabled:b,className:"w-full flex items-center justify-center gap-3 px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,r.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,r.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,r.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,r.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,r.jsx)("span",{className:"text-slate-700 dark:text-slate-200 font-medium",children:b?"Redirecting...":"Continue with Google"})]}),(0,r.jsxs)("div",{className:"relative my-6",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,r.jsx)("div",{className:"w-full border-t border-slate-200 dark:border-slate-700"})}),(0,r.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,r.jsx)("span",{className:"px-2 bg-white dark:bg-slate-800 text-slate-500",children:"or continue with email"})})]}),(0,r.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Email"}),(0,r.jsx)("input",{id:"email",type:"email",value:d,onChange:e=>m(e.target.value),required:!0,className:"input",placeholder:"you@example.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Password"}),(0,r.jsx)("input",{id:"password",type:"password",value:p,onChange:e=>g(e.target.value),required:!0,className:"input",placeholder:"********",minLength:6})]}),h&&(0,r.jsx)("p",{className:"text-sm ".concat(h.includes("Check your email")?"text-green-600":"text-red-600"),children:h}),(0,r.jsx)("button",{type:"submit",disabled:x,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Loading...":c?"Sign Up":"Sign In"})]}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsx)("button",{onClick:()=>u(!c),className:"text-sm text-brand-600 hover:text-brand-700",children:c?"Already have an account? Sign in":"Don't have an account? Sign up"})}),(0,r.jsx)("div",{className:"mt-6 pt-6 border-t border-slate-200 dark:border-slate-700",children:(0,r.jsx)(a.default,{href:"/today",className:"block text-center text-sm text-slate-500 hover:text-slate-700 dark:hover:text-slate-300",children:"Continue as guest"})})]})})}},19894:function(e,t,o){"use strict";o.r(t),o.d(t,{AuthProvider:function(){return p},useAuth:function(){return g}});var r=o(89075),s=o(50511),l=o(52453);let a=null,n=async(e,t,o)=>await o(),i={SESSION_BRIDGE:"leetloop_session_bridge"},c={AUTH_CHANGE:"leetloop:auth-change",SIGNED_OUT:"leetloop:signed-out",GUEST_ID:"leetloop:guest-id"};function u(e){if(console.log("[LeetLoop Web] storeSessionBridge called, hasSession:",!!e),(null==e?void 0:e.access_token)&&(null==e?void 0:e.refresh_token)){let t={access_token:e.access_token,refresh_token:e.refresh_token};localStorage.setItem(i.SESSION_BRIDGE,JSON.stringify(t)),console.log("[LeetLoop Web] Session bridge stored in localStorage"),window.dispatchEvent(new CustomEvent(c.AUTH_CHANGE,{detail:t})),console.log("[LeetLoop Web] Dispatched auth-change event")}else localStorage.removeItem(i.SESSION_BRIDGE)}function d(){localStorage.removeItem(i.SESSION_BRIDGE),window.dispatchEvent(new CustomEvent(c.SIGNED_OUT))}let m=(0,s.createContext)(void 0);function p(e){let{children:t}=e,[o,i]=(0,s.useState)(null),[p,g]=(0,s.useState)(null),[x,L]=(0,s.useState)(!0),b=(0,s.useMemo)(()=>a||(a=(0,l.createBrowserClient)("https://ewezpbczwioxyflyffyy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3ZXpwYmN6d2lveHlmbHlmZnl5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzMDI3MzAsImV4cCI6MjA4NDg3ODczMH0.XxVIJRRYNR_IdMhVN0gGMVYghb19Uyly4rbwxJJKDVg",{auth:{flowType:"pkce",detectSessionInUrl:!0,persistSession:!0,debug:!1,lock:n}})),[]),S=(null==o?void 0:o.id)||h();(0,s.useEffect)(()=>{let e=!0,t=null;(async()=>{try{let{data:{session:o}}=await b.auth.getSession();if(e){var t;g(o),i(null!==(t=null==o?void 0:o.user)&&void 0!==t?t:null),L(!1),u(o)}}catch(t){t instanceof Error&&"AbortError"===t.name?console.log("[LeetLoop] Ignoring AbortError in dev mode"):console.error("[LeetLoop] Error getting session:",t),e&&L(!1)}})();let o=h();o&&window.dispatchEvent(new CustomEvent(c.GUEST_ID,{detail:o}));try{let{data:o}=b.auth.onAuthStateChange(async(t,o)=>{if(e){var r;g(o),i(null!==(r=null==o?void 0:o.user)&&void 0!==r?r:null),L(!1),u(o),"SIGNED_IN"===t&&(null==o?void 0:o.user)&&await f(b,o.user.id),"SIGNED_OUT"===t&&d()}});t=o.subscription}catch(e){console.error("[LeetLoop] Error setting up auth listener:",e)}return()=>{e=!1,null==t||t.unsubscribe()}},[b]);let _=async(e,t)=>{let{error:o}=await b.auth.signInWithPassword({email:e,password:t});if(o)throw o},I=async(e,t)=>{let{error:o}=await b.auth.signUp({email:e,password:t});if(o)throw o},v=async()=>{let{error:e}=await b.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(e)throw e},w=async()=>{let{error:e}=await b.auth.signOut();if(e)throw e;d()};return(0,r.jsx)(m.Provider,{value:{user:o,session:p,userId:S,loading:x,signIn:_,signUp:I,signInWithGoogle:v,signOut:w},children:t})}function g(){let e=(0,s.useContext)(m);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function h(){let e=localStorage.getItem("leetloop_user_id");return e||(e=crypto.randomUUID(),localStorage.setItem("leetloop_user_id",e)),e}async function f(e,t){if("true"===localStorage.getItem("leetloop_migration_complete")){console.log("[LeetLoop] Migration already marked complete, skipping"),console.log('[LeetLoop] To retry migration, run: localStorage.removeItem("leetloop_migration_complete")');return}let o=localStorage.getItem("leetloop_user_id");if(!o){console.log("[LeetLoop] No guest user ID found, nothing to migrate"),localStorage.setItem("leetloop_migration_complete","true");return}if(o===t){console.log("[LeetLoop] Guest ID matches auth ID, no migration needed"),localStorage.setItem("leetloop_migration_complete","true");return}console.log("[LeetLoop] Starting migration..."),console.log("[LeetLoop] Guest UUID:",o),console.log("[LeetLoop] Auth User ID:",t);try{let{data:r,error:s}=await e.rpc("migrate_guest_to_auth",{p_guest_id:o,p_auth_id:t});if(s){console.error("[LeetLoop] Migration RPC error:",s),console.error("[LeetLoop] Error code:",s.code),console.error("[LeetLoop] Error message:",s.message),console.error("[LeetLoop] Error details:",s.details),console.error("[LeetLoop] Migration NOT marked complete due to error"),console.error("[LeetLoop] You can manually migrate by running SQL in Supabase:"),console.error("UPDATE submissions SET user_id = '".concat(t,"' WHERE user_id = '").concat(o,"';")),console.error("UPDATE skill_scores SET user_id = '".concat(t,"' WHERE user_id = '").concat(o,"';")),console.error("UPDATE review_queue SET user_id = '".concat(t,"' WHERE user_id = '").concat(o,"';"));return}if(!r||"object"!=typeof r){console.error("[LeetLoop] Migration returned unexpected data:",r),console.error("[LeetLoop] Migration NOT marked complete due to unexpected response");return}if(!0!==r.success){console.error("[LeetLoop] Migration returned success=false:",r),console.error("[LeetLoop] Migration NOT marked complete");return}console.log("[LeetLoop] Migration successful!"),console.log("[LeetLoop] Migrated counts:",r.migrated),localStorage.setItem("leetloop_migration_complete","true"),localStorage.setItem("leetloop_user_id",t),console.log("[LeetLoop] Updated local user ID to auth ID")}catch(e){console.error("[LeetLoop] Migration exception:",e),console.error("[LeetLoop] Migration NOT marked complete due to exception"),console.error("[LeetLoop] Guest UUID for manual migration:",o),console.error("[LeetLoop] Auth User ID for manual migration:",t)}}window.resetLeetLoopMigration=()=>{localStorage.removeItem("leetloop_migration_complete"),console.log("[LeetLoop] Migration flag cleared. Sign out and back in to retry migration.")},window.getLeetLoopMigrationInfo=()=>{console.log("[LeetLoop] Migration complete:",localStorage.getItem("leetloop_migration_complete")),console.log("[LeetLoop] Guest user ID:",localStorage.getItem("leetloop_user_id"))}},65095:function(e,t,o){"use strict";var r=o(17353);o.o(r,"usePathname")&&o.d(t,{usePathname:function(){return r.usePathname}}),o.o(r,"useRouter")&&o.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[453,980,852,999,744],function(){return e(e.s=70332)}),_N_E=e.O()}]);